<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Word Maze Task</title>
    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.3.3/css/jspsych.css" />
    <script src="https://unpkg.com/jspsych@7.3.3/dist/jspsych.js"></script>
    <!-- Plugins -->
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.2.0"></script>
  </head>

  <body>
    This is a word maze task. Choose the correct option to make a meaningful sentence.
  </body>

  <script>
    const jsPsych = initJsPsych({
      override_safe_mode: true,
      on_finish: function () {
        jsPsych.data.displayData('csv');
      }
    });

    // Word + Distractor 
    const sentences = [ 
      {
        sentence_id: "amb1",
        condition:"ambiguous",
        target: "Put the frog on the napkin onto the box.",
        distractor: "xxx run some hope above his year until any." 
      },
      {
        sentence_id: "amb2",
        condition: "ambiguous",
        target: "Put the rabbit on the towel onto the tray.",
        distractor: "xxx write those storm once no floor than his."
      },
      {
        sentence_id: "amb3",
        condition: "ambiguous",
        target: "Put the panda on the blanket onto the chair.",
        distractor: "xxx feed this names over that gap out no."
      },
      {
        sentence_id: "unamb1",
        condition: "unambiguous",
        target: "Put the frog that is on the napkin onto the box.", 
        distractor: "xxx guided no course which be to those attempts in an."
      },
      {
        sentence_id: "unamb2",
        condition: "unambiguous",
        target: "Put the rabbit that is on the towel onto the tray.",
        distractor: "xxx settled such view whose has off a egg against half."
      },
      {
        sentence_id: "unamb3",
        condition: "unambiguous",
        target: "Put the panda that is on the blanket onto the chair.",
        distractor: "xxx coming every nature who ought from both part away both."
      },
      {
        sentence_id: "filler1",
        condition: "filler",
        target: "Put the frog on the box.",
        distractor: "xxx love every door onto all." 
      },
      {
        sentence_id: "filler2",
        condition: "filler",
        target: "Put the pen on the tray.",
        distractor: "xxx be each rowe down a."
      },
      {
        sentence_id: "filler3",
        condition: "filler",
        target: "Put the cup on the desk.",
        distractor: "xxx put any cow aboard what."
      },
      
    ];

    const amb = sentences.filter(s => s.condition === "ambiguous");
    const unamb = sentences.filter(s => s.condition === "unambiguous");
    const filler = sentences.filter(s => s.condition === "filler");
    

    const fixation = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: '<p style="font-size: 48px;">+</p>',
      choices: "NO_KEYS",
      trial_duration: 500
    };

    // For each trial, display two words with randomized left/right positioning
    const wordMazeTrials = (sentence) => {
      const targetWords = sentence.target.split(" ");
      const distractorWords = sentence.distractor.split(" ");
      const trials = []; 
      trials.push(fixation); 

      for (let i = 0; i < targetWords.length; i++) {
        const word = targetWords[i];
        const distractor = distractorWords[i];
      
      const isTargetOnLeft = Math.random() < 0.5;

      const leftWord = isTargetOnLeft ? word : distractor;
      const rightWord = isTargetOnLeft ? distractor : word;

      const trial= {
        type: jsPsychHtmlButtonResponse,
        stimulus: '',  // empty because we only focus on buttons
        choices: [
          `<div style="font-size:28px; width:200px;">${leftWord}</div>`,
          `<div style="font-size:28px; width:200px;">${rightWord}</div>`
        ],
        data: {
          word: word,
          distractor: distractor,
          correct_response: isTargetOnLeft ? 0 : 1,
          sentence_id: sentence.sentence_id,
          word_position: i + 1
        },
        on_finish: function (data) {
          data.correct = data.response === data.correct_response;
        }
      };
      trials.push(trial);
    }
  
  return trials;
  };
    // Generating all trials in sequence
    const timeline = [];
    const randomized_sentences = jsPsych.randomization.shuffle(sentences); //sentences will be presented randomly
    randomized_sentences.forEach(sentence => {
      const trials_for_sentence = wordMazeTrials(sentence);
      timeline.push(...trials_for_sentence);
      
    });

    jsPsych.run(timeline);
  </script>
</html>
